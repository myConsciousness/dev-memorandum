# テーブル結合について

- [テーブル結合について](#テーブル結合について)
  - [概要](#概要)
  - [詳細](#詳細)
    - [内部結合](#内部結合)
    - [左外部結合](#左外部結合)
    - [右外部結合](#右外部結合)
    - [完全外部結合](#完全外部結合)

## 概要

はっきり言って私は `SQL` があまり好きじゃない。
`SQL` が言語として非常に完成度が高く様々な分野で重宝される技術なのは、
そんなに長くない私のエンジニア人生を通して見てみても一目瞭然だ。

だけれども、読んでいても書いていても面白くない `SQL` はやはり好きになれない。
苦手意識というよりトラウマに近い何かを感じるほどだ。

そんな私が `SQL` を読みまくって書きまくる案件に参画することになった。
やはり、神に慈悲はないようである。

いつまでも嘆いてはいられないので一念発起して初心に戻って `SQL` を勉強してみた。
これはその内の `結合` に関するものだ。

## 詳細

### 内部結合

`内部結合` とは、`表A` と `表B` の重なりあう部分のみを結合する方式である。
結合条件に合致しないレコードは出力結果から除外される。

![内部結合](https://user-images.githubusercontent.com/13072231/105716270-f1e95800-5f61-11eb-8d21-356e917680f7.png)

**_構文:_**

`INNER JOIN` の部分が結合をしている処理、ON 以降には結合の条件を記述する。
以下の例の場合、`TBL1.SOMETHING = TBL2.SOMETHING` で紐づくレコード群のみを取得できる。

```sql
SELECT TBL1.SOMETHING, ... FROM TABLE1 TBL1
  INNER JOIN TABLE2 TBL2
  ON TBL1.SOMETHING = TBL2.SOMETHING
;
```

**_使用場面:_**

- 左右のテーブル間で値が重なり合う部分のみを取得したい場合

### 左外部結合

`左外部結合` とは、`表A` と `表B` の重なり合う部分と `表A` の `表B` と重なっていない全てのレコードを結合する方式である。
左側に指定されたテーブルのレコードは全取得され、結合条件に合致しない右側のレコードは除外される。

![左外部結合](https://user-images.githubusercontent.com/13072231/105717077-0712b680-5f63-11eb-9490-2e05613ff032.png)

**_構文:_**

`LEFT OUTER JOIN` の部分が結合をしている処理、ON 以降には結合の条件を記述する。
以下の例の場合、左側の全レコードと `TBL1.SOMETHING = TBL2.SOMETHING` で紐づく右側のレコード群を取得できる。

```sql
SELECT TBL1.SOMETHING, ... FROM TABLE1 TBL1
  LEFT OUTER JOIN TABLE2 TBL2
  ON TBL1.SOMETHING = TBL2.SOMETHING
;
```

**_使用場面:_**

- 左右のテーブル間で左側に指定したテーブルの全集合と、結合条件に合致する右側の部分集合を取得する場合

> **_Note:_**</br>
> 左のテーブルカラムを結合の対象にし、右側のカラムに同じ値が格納されているデータを結合して表示するが、左側のテーブルのカラムはすべて表示するので、右側のテーブルで結合対象のカラムが見つからない場合には、表示結果が NULL になる。

### 右外部結合

`右外部結合` とは、`表A` と `表B` の重なり合う部分と `表B` の `表A` と重なっていない全てのレコードを結合する方式である。
右側に指定されたテーブルのレコードは全取得され、結合条件に合致しない左側のレコードは除外される。

![右外部結合](https://user-images.githubusercontent.com/13072231/105717442-7b4d5a00-5f63-11eb-9eb7-7ef9dafd00e6.png)

**_構文:_**

`RIGHT OUTER JOIN` の部分が結合をしている処理、ON 以降には結合の条件を記述する。
以下の例の場合、右側の全レコードと `TBL1.SOMETHING = TBL2.SOMETHING` で紐づく左側のレコード群を取得できる。

```sql
SELECT TBL1.SOMETHING, ... FROM TABLE1 TBL1
  RIGHT OUTER JOIN TABLE2 TBL2
  ON TBL1.SOMETHING = TBL2.SOMETHING
;
```

**_使用場面:_**

- 左右のテーブル間で右側に指定したテーブルの全集合と、結合条件に合致する左側の部分集合を取得する場合

> **_Note:_**</br>
> 右のテーブルカラムを結合の対象にし、左側のカラムに同じ値が格納されているデータを結合して表示するが、右側のテーブルのカラムはすべて表示するので、左側のテーブルで結合対象のカラムが見つからない場合には、表示結果が NULL になる。

### 完全外部結合

`完全外部結合` とは、`表A` と `表B` の重なり合う部分と `表A` と `表B` の重なっていない全てのレコードを結合する方式である。

**_構文:_**

`FULL OUTER JOIN` の部分が結合をしている処理、ON 以降には結合の条件を記述する。

```sql
SELECT TBL1.SOMETHING, ... FROM TABLE1 TBL1
  FULL OUTER JOIN TABLE2 TBL2
  ON TBL1.SOMETHING = TBL2.SOMETHING
;
```

**_使用場面:_**

- 左右のテーブル間で結合条件に合致する集合と合致しない集合のどちらも取得したい場合
